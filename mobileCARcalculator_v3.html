<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Career Progression Points Calculator (Teacher II–VII ES & JHS)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px; /* Reduced padding for mobile */
            background: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content horizontally */
            box-sizing: border-box; /* Include padding in element's total width */
        }
        #calculatorContainer {
            width: 95%;
            max-width: 500px; /* Limit the max width for larger screens */
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* More pronounced shadow for the whole captured area */
            box-sizing: border-box; /* Ensure padding is included in the width */
            margin-bottom: 20px; /* Space between calculator and buttons */
        }
        /* Adjusted h1 style to fit within the container */
        #calculatorContainer h1 { /* Target h1 specifically inside calculatorContainer */
            color: #333;
            text-align: center;
            width: 100%; /* H1 takes full width of its container */
            margin-top: 0; /* Remove default top margin */
            margin-bottom: 15px;
            font-size: 1.5em; /* Adjust font size for mobile readability */
        }
        .position-select-container {
            width: 100%; /* Takes full width of #calculatorContainer */
            margin-bottom: 15px;
            text-align: left;
            padding: 0 5px; /* Add some horizontal padding */
            box-sizing: border-box;
        }
        .position-select-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .position-select-container select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        /* Style for the instruction message */
        #positionInstruction {
            font-size: 0.85em; /* Smaller font size */
            color: red; /* Red font color */
            margin-top: 5px;
            text-align: left;
            padding-left: 5px; /* Align with dropdown label */
            display: none; /* Hidden by default */
        }
        /* Style for the disclaimer text */
        #disclaimerText {
            font-size: 0.75em; /* Even smaller font size for disclaimer */
            color: #666; /* Gray font color */
            margin-top: 20px; /* Space above disclaimer */
            text-align: left; /* Aligned to the left */
            padding: 0 5px; /* Consistent padding */
        }
        table {
            border-collapse: collapse;
            width: 100%; /* Make table responsive to its container */
            background: #fff;
            margin-bottom: 0; /* Remove bottom margin as container handles it */
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px; /* Slightly reduced padding for cells */
            text-align: left;
            font-size: 0.9em; /* Adjust font size for mobile readability */
        }
        th {
            background-color: #f0f0f0;
        }
        /* Center the CRITERIA text inside its cell */
        th:first-child {
            text-align: center;
        }
        /* Center the CREDENTIAL DETAILS text inside its cell */
        th:nth-child(2) {
            text-align: center;
        }
        /* Consistent width for select and input fields */
        input[type="number"], select {
            width: 100%;
            padding: 6px; /* Slightly increased padding for better touch targets */
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        /* Adjust width of the credentials column (responsive) */
        td:nth-child(2) {
            width: 65%; /* Give more space to the input fields */
        }
        /* Center text in the points column */
        td:nth-child(3), th:nth-child(3) {
            text-align: center;
            width: 30%; /* Allocate specific width */
            white-space: nowrap; /* Prevent wrapping for the points column */
        }
        /* Center the total points in the total row */
        #totalPoints {
            display: block;
            text-align: center;
            width: 100%;
            font-weight: bold;
        }
        /* Prevent text wrapping for specific criteria labels */
        .criteria-nowrap {
            white-space: nowrap;
        }
        .buttons-container {
            width: 95%; /* Make button container responsive */
            max-width: 500px; /* Match table max width */
            display: flex;
            flex-direction: column; /* Stack buttons vertically on mobile */
            gap: 10px;
        }
        button {
            padding: 12px 15px; /* Larger padding for better touch targets */
            font-size: 1em; /* Readable font size */
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s ease;
            width: 100%; /* Full width for buttons on mobile */
        }
        button:hover {
            background-color: #0056b3;
        }

        /* Custom Modal Styles */
        #customAlertModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            display: flex; /* Use flexbox for centering */
            justify-content: center;
            align-items: center;
        }

        #customAlertModal > div {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
        }

        #customAlertModal p {
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #333;
        }

        #customAlertModal button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: auto; /* Override 100% width from general button style */
        }

        #customAlertModal button:hover {
            background-color: #0056b3;
        }


        /* Media query for larger screens (optional, but good practice for desktop layout) */
        @media (min-width: 600px) {
            .buttons-container {
                flex-direction: row; /* Buttons side-by-side on wider screens */
                justify-content: space-around;
            }
            button {
                width: auto; /* Let buttons size naturally based on content */
                flex-grow: 1; /* Allow them to grow if needed */
            }
        }
    </style>
</head>
<body>
    <div id="calculatorContainer">
        <h1>Career Progression Points Calculator (Teacher II–VII ES & JHS)</h1>
        <div class="position-select-container">
            <label for="positionApplied">Position Applying for:</label>
            <select id="positionApplied">
                <option value="">-- Select Position --</option>
                <option value="Teacher II">Teacher II</option>
                <option value="Teacher III">Teacher III</option>
                <option value="Teacher IV">Teacher IV</option>
                <option value="Teacher V">Teacher V</option>
                <option value="Teacher VI">Teacher VI</option>
                <option value="Teacher VII">Teacher VII</option>
            </select>
            <div id="positionInstruction">Select a position first</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>CRITERIA</th>
                    <th>CREDENTIAL DETAILS</th>
                    <th>POINTS</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Education</td>
                    <td>
                        <select id="education" disabled>
                            <option value="-1">-- Select --</option>
                            <option value="0">No units in Master's Degree</option>
                            <option value="1">1 unit in Master's Degree</option>
                            <option value="2">2 units in Master's Degree</option>
                            <option value="3">3 units in Master's Degree</option>
                            <option value="4">4 units in Master's Degree</option>
                            <option value="5">5 units in Master's Degree</option>
                            <option value="6">6 units in Master's Degree</option>
                            <option value="7">7 units in Master's Degree</option>
                            <option value="8">8 units in Master's Degree</option>
                            <option value="9">9 units in Master's Degree</option>
                            <option value="10">10 units in Master's Degree</option>
                            <option value="11">11 units in Master's Degree</option>
                            <option value="12">12 units in Master's Degree</option>
                            <option value="13">13 units in Master's Degree</option>
                            <option value="14">14 units in Master's Degree</option>
                            <option value="15">15 units in Master's Degree</option>
                            <option value="16">16 units in Master's Degree</option>
                            <option value="17">17 units in Master's Degree</option>
                            <option value="18">18 units in Master's Degree</option>
                            <option value="19">19 units in Master's Degree</option>
                            <option value="20">20 units in Master's Degree</option>
                            <option value="21">21 units in Master's Degree</option>
                            <option value="22">22 units in Master's Degree</option>
                            <option value="23">23 units in Master's Degree</option>
                            <option value="24">24 units in Master's Degree</option>
                            <option value="25">25 units in Master's Degree</option>
                            <option value="26">26 units in Master's Degree</option>
                            <option value="27">27 units in Master's Degree</option>
                            <option value="28">28 units in Master's Degree</option>
                            <option value="29">29 units in Master's Degree</option>
                            <option value="30">30 units in Master's Degree</option>
                            <option value="31">31 units in Master's Degree</option>
                            <option value="32">32 units in Master's Degree</option>
                            <option value="33">33 units in Master's Degree</option>
                            <option value="34">34 units in Master's Degree</option>
                            <option value="35">35 units in Master's Degree</option>
                            <option value="36">36 units in Master's Degree</option>
                            <option value="37">37 units in Master's Degree</option>
                            <option value="38">38 units in Master's Degree</option>
                            <option value="39">39 units in Master's Degree</option>
                            <option value="40">40 units in Master's Degree</option>
                            <option value="41">41 units in Master's Degree</option>
                            <option value="42">42 units in Master's Degree</option>
                            <option value="43">More than 42 Units in Master's Degree</option>
                            <option value="44">CAR towards Master's Degree</option>
                            <option value="45">Master's Degree Holder</option>
                            <option value="46">1 Unit in Doctorate Degree</option>
                            <option value="47">2 Units in Doctorate Degree</option>
                            <option value="48">3 Units in Doctorate Degree</option>
                            <option value="49">4 Units in Doctorate Degree</option>
                            <option value="50">5 Units in Doctorate Degree</option>
                            <option value="51">6 Units in Doctorate Degree</option>
                            <option value="52">7 Units in Doctorate Degree</option>
                            <option value="53">8 Units in Doctorate Degree</option>
                            <option value="54">9 Units in Doctorate Degree</option>
                            <option value="55">10 Units in Doctorate Degree</option>
                            <option value="56">11 Units in Doctorate Degree</option>
                            <option value="57">12 Units in Doctorate Degree</option>
                            <option value="58">13 Units in Doctorate Degree</option>
                            <option value="59">14 Units in Doctorate Degree</option>
                            <option value="60">15 Units in Doctorate Degree</option>
                            <option value="61">16 Units in Doctorate Degree</option>
                            <option value="62">17 Units in Doctorate Degree</option>
                            <option value="63">18 Units in Doctorate Degree</option>
                            <option value="64">19 Units in Doctorate Degree</option>
                            <option value="65">20 Units in Doctorate Degree</option>
                            <option value="66">21 Units in Doctorate Degree</option>
                            <option value="67">22 Units in Doctorate Degree</option>
                            <option value="68">23 Units in Doctorate Degree</option>
                            <option value="69">24 Units in Doctorate Degree</option>
                            <option value="70">More than 24 Units in Doctorate Degree</option>
                            <option value="71">CAR towards Doctorate Degree</option>
                            <option value="72">Doctorate Degree Holder</option>
                        </select>
                    </td>
                    <td><span id="eduPoints">0</span> /10</td>
                </tr>
                <tr>
                    <td>Training</td>
                    <td><input type="number" id="training" min="0" placeholder="Total hours of training" disabled></td>
                    <td><span id="trainPoints">0</span> /10</td>
                </tr>
                <tr>
                    <td>Experience</td>
                    <td><input type="number" id="experience" min="0" placeholder="Total months of experience" disabled></td>
                    <td><span id="expPoints">0</span> /10</td>
                </tr>
                <tr>
                    <td>Performance</td>
                    <td><input type="number" id="performance" min="0" max="5" step="0.01" placeholder="Final rating (SY 24-25 IPCRF)" disabled></td>
                    <td><span id="perfPoints">0</span> /30</td>
                </tr>
                <tr>
                    <td class="criteria-nowrap">PPST COIs</td>
                    <td><input type="number" id="cois" min="0" max="25" placeholder="Enter COIs (max 25)" disabled></td>
                    <td><span id="coisPoints">0</span> /25</td>
                </tr>
                <tr>
                    <td class="criteria-nowrap">PPST NCOIs</td>
                    <td><input type="number" id="ncois" min="0" max="15" placeholder="Enter NCOIs (max 15)" disabled></td>
                    <td><span id="ncoisPoints">0</span> /15</td>
                </tr>
                <tr>
                    <th colspan="2">TOTAL POINTS</th>
                    <th><span id="totalPoints">0</span></th>
                </tr>
            </tbody>
        </table>
        <div id="disclaimerText">
            Disclaimer: This calculator is an unofficial tool and is not provided or endorsed by the Department of Education (DepEd). It is intended solely to assist applicants in estimating their points based on existing guidelines. For official evaluation and results, please refer to your respective HR or division office.
        </div>
    </div>

    <div class="buttons-container">
        <button id="resetButton">Reset Fields</button>
        <button id="saveButton">Save as Image</button>
    </div>

    <!-- Custom Modal Structure -->
    <div id="customAlertModal">
        <div>
            <p id="alertMessage"></p>
            <button id="closeAlertButton">OK</button>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // Subtraction values based on position applied
        const subtractionValues = {
            "Teacher II": { education: 6, training: 2, experience: 3 },
            "Teacher III": { education: 6, training: 3, experience: 5 },
            "Teacher IV": { education: 6, training: 3, experience: 7 },
            "Teacher V": { education: 6, training: 4, experience: 7 },
            "Teacher VI": { education: 6, training: 4, experience: 9 },
            "Teacher VII": { education: 6, training: 5, experience: 9 }
        };

        // Education points lookup
        const educationPointsLookup = [
            6, 6, 6, 6, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9, 9, 10, 10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 20,
            21, 21, 21, 22, 22, 22, 23, 23, 23, 24, 24, 24, 25, 25, 25, 26, 26, 26, 27, 27, 27, 28, 28, 28, 29, 29, 30, 31
        ];

        // Generic function to map calculated increments to final points (0-10)
        const getPointsFromIncrementTable = (increments) => {
            if (increments >= 10) return 10;
            if (increments >= 8) return 8;
            if (increments >= 6) return 6;
            if (increments >= 4) return 4;
            if (increments >= 2) return 2;
            return 0;
        };

        const getEducationPoints = (eduIndex, eduSubtract) => {
            if (eduIndex === -1 || isNaN(eduIndex) || eduIndex >= educationPointsLookup.length) {
                return 0;
            }
            const correspondingLevel = educationPointsLookup[eduIndex];
            const increments = correspondingLevel - eduSubtract;
            return getPointsFromIncrementTable(increments);
        };

        // Training hours to level lookup
        const trainingLevels = [
            1, 1, 1, 1, 1, 1, 1, 1, // 0-7 hours -> level 1
            2, 2, 2, 2, 2, 2, 2, 2, // 8-15 hours -> level 2
            3, 3, 3, 3, 3, 3, 3, 3, // 16-23 hours -> level 3
            4, 4, 4, 4, 4, 4, 4, 4, // 24-31 hours -> level 4
            5, 5, 5, 5, 5, 5, 5, 5, // 32-39 hours -> level 5
            6, 6, 6, 6, 6, 6, 6, 6, // 40-47 hours -> level 6
            7, 7, 7, 7, 7, 7, 7, 7, // 48-55 hours -> level 7
            8, 8, 8, 8, 8, 8, 8, 8, // 56-63 hours -> level 8
            8, // 64 hours -> level 8 (as per provided list, if this is a typo and should be 9, adjust)
            9, 9, 9, 9, 9, 9, 9, // 65-71 hours -> level 9
            10, 10, 10, 10, 10, 10, 10, 10, // 72-79 hours -> level 10
            11, 11, 11, 11, 11, 11, 11, 11, // 80-87 hours -> level 11
            12, 12, 12, 12, 12, 12, 12, 12, // 88-95 hours -> level 12
            13, 13, 13, 13, 13, 13, 13, 13, // 96-103 hours -> level 13
            14, 14, 14, 14, 14, 14, 14, 14, // 104-111 hours -> level 14
            15, 15, 15, 15, 15, 15, 15, 15, // 112-119 hours -> level 15
            16, 16, 16, 16, 16, 16, 16, 16, // 120-127 hours -> level 16
            17, 17, 17, 17, 17, 17, 17, 17, // 128-135 hours -> level 17
            18, 18, 18, 18, 18, 18, 18, 18, // 136-143 hours -> level 18
            19, 19, 19, 19, 19, 19, 19, 19, // 144-151 hours -> level 19
            20, 20, 20, 20, 20, 20, 20, 20, // 152-159 hours -> level 20
            21, 21, 21, 21, 21, 21, 21, 21, // 160-167 hours -> level 21
            22, 22, 22, 22, 22, 22, 22, 22, // 168-175 hours -> level 22
            23, 23, 23, 23, 23, 23, 23, 23, // 176-183 hours -> level 23
            24, 24, 24, 24, 24, 24, 24, 24, // 184-191 hours -> level 24
            25, 25, 25, 25, 25, 25, 25, 25, // 192-199 hours -> level 25
            26, 26, 26, 26, 26, 26, 26, 26, // 200-207 hours -> level 26
            27, 27, 27, 27, 27, 27, 27, 27, // 208-215 hours -> level 27
            28, 28, 28, 28, 28, 28, 28, 28, // 216-223 hours -> level 28
            29, 29, 29, 29, 29, 29, 29, 29, // 224-231 hours -> level 29
            30, 30, 30, 30, 30, 30, 30, 30, // 232-239 hours -> level 30
            31 // 240 hours or more -> level 31 (for any hours >= 240, it will cap at level 31)
        ];

        const getTrainingPoints = (hours, trainSubtract) => {
            let selectedLevel = 0;
            if (hours >= trainingLevels.length) {
                selectedLevel = trainingLevels[trainingLevels.length - 1]; // Use max level if hours exceed the list
            } else if (hours >= 0) {
                selectedLevel = trainingLevels[hours];
            } else {
                selectedLevel = 0; // For negative or invalid input
            }
                
            const increments = selectedLevel - trainSubtract;
            return getPointsFromIncrementTable(increments);
        };

        // Experience months to level lookup
        const experienceLevels = [
            0, 0, 0, 0, 0, // Months 0-4 (assuming 0 points for less than 5 months as per previous behavior)
            1, // 5 months
            2, 2, 2, 2, 2, 2, // 6-11 months
            3, 3, 3, 3, 3, 3, // 12-17 months
            4, 4, 4, 4, 4, 4, // 18-23 months
            5, 5, 5, 5, 5, 5, // 24-29 months
            6, 6, 6, 6, 6, 6, // 30-35 months
            7, 7, 7, 7, 7, 7, // 36-41 months
            8, 8, 8, 8, 8, 8, // 42-47 months
            9, 9, 9, 9, 9, 9, // 48-53 months
            10, 10, 10, 10, 10, 10, // 54-59 months
            11, 11, 11, 11, 11, 11, // 60-65 months
            12, 12, 12, 12, 12, 12, // 66-71 months
            13, 13, 13, 13, 13, 13, // 72-77 months
            14, 14, 14, 14, 14, 14, // 78-83 months
            15, 15, 15, 15, 15, 15, // 84-89 months
            16, 16, 16, 16, 16, 16, // 90-95 months
            17, 17, 17, 17, 17, 17, // 96-101 months
            18, 18, 18, 18, 18, 18, // 102-107 months
            19, 19, 19, 19, 19, 19, // 108-113 months
            20, 20, 20, 20, 20, 20, // 114-119 months
            21, 21, 21, 21, 21, 21, // 120-125 months
            22, 22, 22, 22, 22, 22, // 126-131 months
            23, 23, 23, 23, 23, 23, // 132-137 months
            24, 24, 24, 24, 24, 24, // 138-143 months
            25, 25, 25, 25, 25, 25, // 144-149 months
            26, 26, 26, 26, 26, 26, // 150-155 months
            27, 27, 27, 27, 27, 27, // 156-161 months
            28, 28, 28, 28, 28, 28, // 162-167 months
            29, 29, 29, 29, 29, 29, // 168-173 months
            30, 30, 30, 30, 30, 30, // 174-179 months
            31, 31 // 180 months or more -> level 31 (for any months >= 180, it will cap at level 31)
        ];

        const getExperiencePoints = (months, expSubtract) => {
            let selectedLevel = 0;
            // Handle months less than 5 explicitly as per your provided list start
            if (months < 5) {
                selectedLevel = 0; // If less than 5 months, assuming 0 points.
            } else if (months >= experienceLevels.length + 5 - 1) { // Adjusted to correctly index beyond 180 months
                selectedLevel = experienceLevels[experienceLevels.length - 1]; // Use max level if months exceed the list
            } else if (months >= 0) {
                selectedLevel = experienceLevels[months]; // Direct mapping based on index (assuming index starts from 0 for 0 months)
            } else {
                selectedLevel = 0; // For negative or invalid input
            }

            const increments = selectedLevel - expSubtract;
            return getPointsFromIncrementTable(increments);
        };

        // Function to show custom alert modal
        const showMessage = (message) => {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('customAlertModal').style.display = 'flex';
        };

        // Event listener for closing the custom alert modal
        document.getElementById('closeAlertButton').addEventListener('click', () => {
            document.getElementById('customAlertModal').style.display = 'none';
        });

        // Get references to all input fields that need to be toggled
        const togglableInputs = [
            document.getElementById('education'),
            document.getElementById('training'),
            document.getElementById('experience'),
            document.getElementById('performance'),
            document.getElementById('cois'),
            document.getElementById('ncois')
        ];

        // Function to enable or disable input fields
        const toggleInputFields = (enable) => {
            togglableInputs.forEach(input => {
                input.disabled = !enable;
                // Reset values when disabling to prevent stale data from affecting calculations
                if (!enable) {
                    if (input.tagName === 'SELECT') {
                        input.value = "-1"; // For select elements
                    } else {
                        input.value = ""; // For number inputs
                    }
                }
            });
            updatePoints(); // Recalculate points after toggling
        };

        const updatePoints = () => {
            const positionApplied = document.getElementById('positionApplied').value;
            const positionInstruction = document.getElementById('positionInstruction');
            let eduSubtract = 0;
            let trainSubtract = 0;
            let expSubtract = 0;

            // Show/hide instruction message based on position selection
            if (!positionApplied) {
                positionInstruction.style.display = 'block'; // Show the message
                // If no position is selected, ensure all points are 0
                document.getElementById('eduPoints').textContent = 0;
                document.getElementById('trainPoints').textContent = 0;
                document.getElementById('expPoints').textContent = 0;
                document.getElementById('perfPoints').textContent = (0).toFixed(2);
                document.getElementById('coisPoints').textContent = 0;
                document.getElementById('ncoisPoints').textContent = 0;
                document.getElementById('totalPoints').textContent = (0).toFixed(2);
                return; // Stop the function here
            } else {
                positionInstruction.style.display = 'none'; // Hide the message
            }

            // Set subtraction values based on selected position
            if (subtractionValues[positionApplied]) {
                eduSubtract = subtractionValues[positionApplied].education;
                trainSubtract = subtractionValues[positionApplied].training;
                expSubtract = subtractionValues[positionApplied].experience;
            }

            const eduIndex = parseInt(document.getElementById('education').value);
            const trainHours = parseInt(document.getElementById('training').value) || 0;
            const expMonths = parseInt(document.getElementById('experience').value) || 0;
            const performanceInput = parseFloat(document.getElementById('performance').value) || 0;
            let cois = parseInt(document.getElementById('cois').value) || 0;
            let ncois = parseInt(document.getElementById('ncois').value) || 0;

            // Validate PPST COIs
            if (cois > 25) {
                showMessage("PPST COIs cannot exceed 25. Value has been set to 25.");
                cois = 25;
                document.getElementById('cois').value = 25;
            }

            // Validate PPST NCOIs
            if (ncois > 15) {
                showMessage("PPST NCOIs cannot exceed 15. Value has been set to 15.");
                ncois = 15;
                document.getElementById('ncois').value = 15;
            }

            const calculatedEduPoints = getEducationPoints(eduIndex, eduSubtract);
            const trainPoints = getTrainingPoints(trainHours, trainSubtract);
            const expPoints = getExperiencePoints(expMonths, expSubtract);

            // Performance calculation: (input value / 5) * 30
            const perfPoints = (performanceInput / 5) * 30;
            // Ensure performance points do not exceed the max possible (30) if input is scaled or clamped
            const finalPerfPoints = Math.min(perfPoints, 30);


            const coisPoints = cois;
            const ncoisPoints = ncois;

            document.getElementById('eduPoints').textContent = calculatedEduPoints;
            document.getElementById('trainPoints').textContent = trainPoints;
            document.getElementById('expPoints').textContent = expPoints;
            document.getElementById('perfPoints').textContent = finalPerfPoints.toFixed(2); /* Show 2 decimal places for performance */
            document.getElementById('coisPoints').textContent = coisPoints;
            document.getElementById('ncoisPoints').textContent = ncoisPoints;

            const total = calculatedEduPoints + trainPoints + expPoints + finalPerfPoints + coisPoints + ncoisPoints;
            document.getElementById('totalPoints').textContent = total.toFixed(2); /* Show 2 decimal places for total */
        };

        // Attach event listeners to all input and select elements for real-time updates
        document.querySelectorAll('input, select').forEach(input => {
            // Exclude the positionApplied dropdown itself from this general listener
            if (input.id !== 'positionApplied') {
                input.addEventListener('input', updatePoints);
                input.addEventListener('change', updatePoints);
            }
        });

        // Specific event listener for the positionApplied dropdown
        document.getElementById('positionApplied').addEventListener('change', (event) => {
            const selectedPosition = event.target.value;
            if (selectedPosition === "") {
                toggleInputFields(false); // Disable if "-- Select Position --" is chosen
            } else {
                toggleInputFields(true); // Enable if a valid position is chosen
            }
            updatePoints(); // Always update points after position change
        });

        // Reset button functionality
        document.getElementById('resetButton').addEventListener('click', () => {
            document.getElementById('positionApplied').value = ""; // Reset position dropdown
            toggleInputFields(false); // Disable all other fields and reset their values
            updatePoints(); // Recalculate and update total (will be 0)
        });

        // Save as Image button functionality using html2canvas
        document.getElementById('saveButton').addEventListener('click', () => {
            const calculatorContainer = document.getElementById('calculatorContainer'); // Target the calculator container
            html2canvas(calculatorContainer, {
                scale: 2, // Increase scale for higher resolution screenshot
                useCORS: true // Important for capturing external images if any (though not here)
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'assessment_results.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });

        // Initial setup on page load
        toggleInputFields(false); // Disable all inputs initially
        updatePoints(); // Set initial total to 0 and show instruction
    </script>
</body>
</html>
